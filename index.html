<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Pink-Kush Sticker Generator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="color-scheme" content="light">
  <meta name="theme-color" content="#ffffff">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🌸</text></svg>">
  <style>
    :root{
      --btn-from:#ec4899;--btn-to:#be185d;
      --text:#111;--subtle:#555;--bg:#fff;
    }
    *{box-sizing:border-box;margin:0;font-family:Inter,system-ui,sans-serif}
    html,body{height:100%;background:var(--bg);color:var(--text)}
    #smoke{position:fixed;inset:0;z-index:0}
    main{z-index:10;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:1rem;text-align:center}
    h1{font-size:clamp(2.5rem,8vw,5rem);font-weight:800;letter-spacing:-.04em}
    p.sub{margin:.25rem 0 2rem;color:var(--subtle)}
    #card{width:clamp(300px,90vw,420px);aspect-ratio:1/1;background:#fff;border-radius:24px;box-shadow:0 25px 50px -12px rgba(0,0,0,.15);display:grid;place-content:center;position:relative}
    .loader{width:56px;height:56px;border:4px solid #0001;border-left-color:var(--btn-from);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    #sticker{max-width:85%;max-height:85%;border-radius:16px;transition:opacity .4s,transform .4s}
    #sticker.hidden{opacity:0;transform:scale(.95)}
    .generate-btn{margin-top:2rem;padding:.875rem 2.5rem;border:none;border-radius:999px;background:linear-gradient(135deg,var(--btn-from) 0%,var(--btn-to) 100%);color:#fff;font-weight:600;box-shadow:0 10px 25px -5px rgba(236,72,153,.35);cursor:pointer;transition:all .3s}
    .generate-btn:hover:not(:disabled){transform:translateY(-3px);box-shadow:0 15px 35px -5px rgba(236,72,153,.45)}
    .generate-btn:disabled{opacity:.5;cursor:not-allowed}
    footer{font-size:.7rem;color:var(--subtle);margin-top:auto;padding-bottom:1rem}
    @media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}
  </style>
</head>
<body>
  <div id="smoke"></div>
  <main>
    <h1>Pink-Kush Stickers</h1>
    <p class="sub">Never the same sticker twice</p>

    <div id="card">
      <div id="loader"><div class="loader"></div></div>
      <img id="sticker" alt="Generated sticker">
    </div>

    <button id="newBtn" class="generate-btn">New Sticker</button>

    <footer>AI-generated for demonstration · <a href="https://github.com/yourname/pink-kush-stickers" target="_blank" rel="noopener">GitHub</a></footer>
  </main>

  <script type="module">
    /* ---- off-screen canvas smoke ---- */
    const smokeCanvas=document.createElement('canvas');smokeCanvas.style.cssText='width:100%;height:100%';document.getElementById('smoke').appendChild(smokeCanvas);
    const gl=smokeCanvas.getContext('webgl2',{alpha:true,premultipliedAlpha:true});
    if(!gl){document.getElementById('smoke').remove();}else{
      const vert=`#version 300 es
      in vec2 a;out vec2 uv;void main(){uv=a*.5+.5;gl_Position=vec4(a,0,1);}`;
      const frag=`#version 300 es
      precision highp float;in vec2 uv;uniform float t;out vec4 c;
      vec3 h(vec3 x){return x-floor(x*1.0/289.0)*289.0;}
      vec2 h(vec2 x){return x-floor(x*1.0/289.0)*289.0;}
      vec3 p(vec3 x){return h(((x*34.0)+1.0)*x);}
      float n(vec2 v){
        const vec4 C=vec4(.211324865405187,.366025403784439,-.577350269189626,.024390243902439);
        vec2 i=floor(v+dot(v,C.yy)),x0=v-i+dot(i,C.xx);
        vec2 i1=(x0.x>x0.y)?vec2(1,0):vec2(0,1);
        vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;
        i=h(i);vec3 q=p(p(i.y+vec3(0,i1.y,1))+i.x+vec3(0,i1.x,1));
        vec3 m=max(.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.);
        m=m*m;m=m*m;
        vec3 x=2.0*fract(q*C.www)-1.0,h=abs(x)-.5,ox=floor(x+.5),a0=x-ox;
        m*=1.79284291400159-.85373472095314*(a0*a0+h*h);
        vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;
        return 130.0*dot(m,g);
      }
      float f(vec2 st){float v=0.,a=.5;for(int i=0;i<6;i++){v+=a*n(st);st*=2.0;a*=.5;}return v;}
      void main(){
        vec2 u=uv,y=u;y.y-=(t*.08);
        float s=f(y*2.0+t)*.15,t2=f(y*4.0-t*.5)*.1;
        y.x+=s;y.y+=t2;
        float w=f(y*3.0+t*2.0)*.08;y+=w;
        float r=(f(y*1.5)+f(y*3.0+t)+f(y*6.0-t*.8))/3.;
        vec3 k=mix(vec3(.96,.51,.75),vec3(.88,.27,.53),smoothstep(-.5,.5,r));
        k=mix(k,vec3(.98,.71,.82),smoothstep(0.,1.,f(y*3.0+t)));
        k=mix(k,vec3(.7,.1,.3),smoothstep(-1.,0.,f(y*1.5)));
        k*=.25+.7*(r+1.)*.5;
        float a=(r+1.)*.5*smoothstep(0.,.4,u.y)*smoothstep(1.,.6,u.y)*smoothstep(0.,.2,u.x)*smoothstep(1.,.8,u.x);
        c=vec4(k,clamp(a,0.,.9));
      }`;
      const prog=gl.createProgram();const vs=gl.createShader(gl.VERTEX_SHADER),fs=gl.createShader(gl.FRAGMENT_SHADER);
      [vs,fs].forEach((sh,i)=>{gl.shaderSource(sh,i?frag:vert);gl.compileShader(sh);gl.attachShader(prog,sh);});
      gl.linkProgram(prog);gl.useProgram(prog);
      const buf=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buf);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),gl.STATIC_DRAW);
      const loc=gl.getAttribLocation(prog,'a');gl.enableVertexAttribArray(loc);gl.vertexAttribPointer(loc,2,gl.FLOAT,false,0,0);
      const tLoc=gl.getUniformLocation(prog,'t');
      let start=performance.now();
      function draw(){
        gl.viewport(0,0,gl.canvas.width=innerWidth,gl.canvas.height=innerHeight);
        gl.uniform1f(t,(performance.now()-start)*.001);
        gl.drawArrays(gl.TRIANGLE_STRIP,0,4);
        requestAnimationFrame(draw);
      }
      draw();
      addEventListener('resize',()=>gl.viewport(0,0,gl.canvas.width=innerWidth,gl.canvas.height=innerHeight));
    }

    /* ---- sticker engine ---- */
    const prompts=[
      'glass jar full of frosty pink cannabis buds, sticker art, die-cut',
      'cartoon cannabis leaf with heart sunglasses, pastel sticker',
      'minimal line-art bong, sacred geometry, white background sticker',
      'kawaii joint character holding a heart, sticker',
      'retro 70s seed packet “Cosmic Kush”, vintage sticker',
      'psychedelic lion with cannabis-leaf mane, vibrant sticker'
    ];
    let last='';
    const rand=()=>{let p;do{p=prompts[Math.floor(Math.random()*prompts.length)]}while(p===last&&prompts.length>1);last=p;return p};
    const $=s=>document.querySelector(s);
    async function generate(){
      $('#loader').style.display='flex';
      $('#sticker').classList.add('hidden');
      $('#newBtn').disabled=true;
      const p=rand();
      try{
        const r=await fetch('/api/generate-sticker',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:`${p}, high-quality sticker, crisp lines, vibrant colours, die-cut, white border, 2D flat illustration`})});
        const j=await r.json();
        if(!j.success) throw new Error(j.error||'gen failed');
        $('#sticker').src='data:image/jpeg;base64,'+j.image;
        $('#sticker').onload=()=>{$('#loader').style.display='none';$('#sticker').classList.remove('hidden');$('#newBtn').disabled=false};
      }catch(e){console.error(e);$('#loader').innerHTML=`<p style=color:#e11>Failed. <button onclick="generate()">Retry</button></p>`;$('#newBtn').disabled=false}
    }
    $('#newBtn').addEventListener('click',generate);
    generate();
  </script>
  <!-- analytics -->
  <script defer data-domain="pink-kush-stickers.vercel.app" src="https://plausible.io/js/script.js"></script>
</body>
</html>
