<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weed Sticker Generator – Pink Kush Smoke</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* ----  BASE STYLES  ---- */
    html, body {
      height: 100%;
      overflow: hidden; /* Prevent any scrollbars */
    }
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      background: #f0f0f0;
      color: #111827;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* ----  PINK-KUSH SMOKE EFFECT  ---- */
    #smoke {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      background: #fff;
      overflow: hidden;
      transition: opacity 0.8s ease-in-out;
    }
    #smoke canvas {
      display: block;
      width: 100%;
      height: 100%;
    }

    /* ----  LOADER ANIMATION  ---- */
    .loader {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: #ec4899;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    
    /* ---- STICKER STYLING ---- */
    /* EDIT: Added styles directly to the sticker for a "floating" effect */
    #sticker {
      /* Shadow to lift the sticker off the background */
      filter: drop-shadow(0 25px 25px rgba(0,0,0,0.3));
      transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
    }
    #sticker.hidden {
      opacity: 0;
      transform: scale(0.9);
    }

    /* ----  BUTTON STYLING  ---- */
    .generate-btn {
      background: linear-gradient(135deg, #ec4899 0%, #be185d 100%);
      color: #fff;
      padding: 0.875rem 2.5rem;
      border-radius: 9999px;
      font-weight: 600;
      font-size: 1rem;
      box-shadow: 0 10px 25px -5px rgba(236, 72, 153, 0.3);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }
    .generate-btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px -5px rgba(236, 72, 153, 0.4);
    }
    .generate-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>

<body class="bg-gray-50">
  <div id="smoke"></div>

  <div class="relative z-10 flex flex-col h-full">
    <header class="w-full text-center pt-12 md:pt-16 px-4">
      <h1 class="text-[clamp(2.5rem,10vw,5rem)] font-extrabold bg-gradient-to-r from-pink-600 to-purple-700 bg-clip-text text-transparent leading-tight">
        Weed Sticker Generator
      </h1>
      <p class="text-gray-500 text-base md:text-lg mt-2">Never the same sticker twice</p>
    </header>

    <!-- EDIT: Main area now centers content vertically and horizontally without a card -->
    <main class="flex-grow flex flex-col justify-center items-center p-4">
      <!-- This container ensures stable layout during loading -->
      <div class="flex-grow flex justify-center items-center flex-col">
        <div id="loader" class="flex flex-col items-center gap-4 text-center p-8 rounded-2xl bg-black bg-opacity-10 backdrop-blur-sm">
          <div class="loader"></div>
          <p class="text-base text-white font-medium">Crafting your sticker…</p>
          <p id="prompt" class="text-sm text-gray-200 italic max-w-[280px]"></p>
        </div>
        <!-- Sticker is now "free" on the page -->
        <img id="sticker" class="hidden max-w-[80vw] h-auto max-h-[55vh] object-contain" alt="AI Generated Weed Sticker">
      </div>
      <button id="newBtn" onclick="generate()" class="generate-btn mt-8 flex-shrink-0">New Sticker</button>
    </main>

    <footer class="w-full text-center text-xs text-gray-500 py-4 px-4">
      Images are AI-generated for demonstration · Developed with ❤️
    </footer>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    /* ----------  SMOKE SHADER (Unchanged) ---------- */
    let scene, camera, renderer, material, uniforms, smokeEl;

    const vertexShader = `varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }`;
    const fragmentShader = `
      varying vec2 vUv;
      uniform float u_time;
      uniform vec2 u_resolution;
      vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
      vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
      vec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }
      float snoise(vec2 v) {
        const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439);
        vec2 i = floor(v + dot(v, C.yy)); vec2 x0 = v - i + dot(i, C.xx);
        vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
        vec4 x12 = x0.xyxy + C.xxzz; x12.xy -= i1;
        i = mod289(i); vec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));
        vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
        m = m*m; m = m*m;
        vec3 x = 2.0 * fract(p * C.www) - 1.0; vec3 h = abs(x) - 0.5; vec3 ox = floor(x + 0.5); vec3 a0 = x - ox;
        m *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);
        vec3 g; g.x = a0.x * x0.x + h.x * x0.y; g.yz = a0.yz * x12.xz + h.yz * x12.yw;
        return 130.0 * dot(m, g);
      }
      float fbm(vec2 st) {
        float value = 0.0; float amplitude = 0.5;
        for (int i = 0; i < 6; i++) { value += amplitude * snoise(st); st *= 2.0; amplitude *= 0.5; }
        return value;
      }
      void main() {
        vec2 uv = vUv; float time = u_time * 0.09;
        vec2 smokeUv = uv; smokeUv.y -= time * 0.4;
        float turbulence1 = fbm(smokeUv * 2.0 + time); float turbulence2 = fbm(smokeUv * 4.0 - time * 0.5);
        smokeUv.x += turbulence1 * 0.15; smokeUv.y += turbulence2 * 0.1;
        float swirl = fbm(smokeUv * 3.0 + time * 2.0); smokeUv += swirl * 0.08;
        float noise1 = fbm(smokeUv * 1.5); float noise2 = fbm(smokeUv * 3.0 + time); float noise3 = fbm(smokeUv * 6.0 - time * 0.8);
        float finalNoise = (noise1 * 0.5 + noise2 * 0.3 + noise3 * 0.2);
        vec3 color1 = vec3(0.85, 0.10, 0.50); vec3 color2 = vec3(0.65, 0.05, 0.45);
        vec3 color3 = vec3(0.75, 0.15, 0.60); vec3 color4 = vec3(0.40, 0.02, 0.30);
        vec3 finalColor = mix(color1, color2, smoothstep(-0.5, 0.5, finalNoise));
        finalColor = mix(finalColor, color3, smoothstep(0.0, 1.0, noise2));
        finalColor = mix(finalColor, color4, smoothstep(-1.0, 0.0, noise1));
        float brightness = 0.25 + 0.7 * (finalNoise + 1.0) * 0.5; finalColor *= brightness;
        float fadeY = smoothstep(0.0, 0.4, uv.y) * smoothstep(1.0, 0.6, uv.y);
        float fadeX = smoothstep(0.0, 0.2, uv.x) * smoothstep(1.0, 0.8, uv.x);
        float alpha = (finalNoise + 1.0) * 0.5; alpha *= fadeY * fadeX; alpha = clamp(alpha, 0.0, 0.95);
        gl_FragColor = vec4(finalColor, alpha);
      }
    `;

    function initSmoke() {
      smokeEl = document.getElementById('smoke');
      scene = new THREE.Scene();
      camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0.1, 10);
      camera.position.z = 1;
      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, powerPreference: 'high-performance' });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setClearColor(0xffffff, 1);
      smokeEl.appendChild(renderer.domElement);
      const geometry = new THREE.PlaneGeometry(2, 2);
      uniforms = { u_time: { value: 0.0 }, u_resolution: { value: new THREE.Vector2(window.innerWidth, window.innerHeight) } };
      material = new THREE.ShaderMaterial({ uniforms, vertexShader, fragmentShader, transparent: true, blending: THREE.NormalBlending });
      const mesh = new THREE.Mesh(geometry, material);
      scene.add(mesh);
      window.addEventListener('resize', onResize, false);
      onResize();
    }

    function onResize() {
      const w = window.innerWidth; const h = window.innerHeight;
      renderer.setSize(w, h);
      uniforms.u_resolution.value.set(w, h);
    }

    function animateSmoke() {
      requestAnimationFrame(animateSmoke);
      uniforms.u_time.value += 0.09;
      renderer.render(scene, camera);
    }

    initSmoke();
    animateSmoke();

    /* ----------  STICKER GENERATION LOGIC  ---------- */
    const basePrompts = [
      "A friendly cartoon cannabis leaf wearing sunglasses, vibrant sticker art",
      "A glass mason jar filled with frosty purple cannabis buds, premium dispensary sticker",
      "A minimalist line-art bong with sacred geometry patterns, clean modern sticker",
      "A vintage seed packet labeled 'Purple Haze Premium', retro sticker illustration",
      "A majestic lion with a flowing mane made of cannabis leaves, regal sticker art",
      "A pattern of cannabis-infused gummy bears in rainbow colors, modern edibles sticker",
      "A single perfect cannabis bud with morning dew drops, macro photography sticker",
      "'Inhale the Good Vibes' typography with cannabis leaf accents, motivational sticker"
    ];
    let lastPrompt = '';

    function getUniquePrompt() {
      let p;
      do { p = basePrompts[Math.floor(Math.random() * basePrompts.length)]; }
      while (p === lastPrompt && basePrompts.length > 1);
      lastPrompt = p;
      return p;
    }
    
    // Using a mock API call to ensure the app is runnable for demonstration.
    function mockApiCall(prompt) {
      return new Promise((resolve) => {
        console.log("Generating with prompt:", prompt);
        setTimeout(() => {
            const placeholderUrl = `https://placehold.co/512x512/86198f/ffffff?text=Sticker!&font=inter`;
            resolve({ success: true, image: placeholderUrl });
        }, 1500 + Math.random() * 1000);
      });
    }

    async function generate() {
      const loader = document.getElementById('loader');
      const stickerImg = document.getElementById('sticker');
      const promptEl = document.getElementById('prompt');
      const btn = document.getElementById('newBtn');

      stickerImg.classList.add('hidden');
      stickerImg.src = '';
      loader.classList.remove('hidden');
      btn.disabled = true;
      smokeEl.style.opacity = 1;

      const promptText = getUniquePrompt();
      promptEl.textContent = `"${promptText}"`;

      try {
        const data = await mockApiCall(promptText);
        
        if (!data.success) throw new Error(data.error || 'Generation failed');

        stickerImg.src = data.image;
        stickerImg.onload = () => {
          loader.classList.add('hidden');
          stickerImg.classList.remove('hidden');
          btn.disabled = false;
          smokeEl.style.opacity = '0.35';
        };
        stickerImg.onerror = () => { throw new Error('Image load fail'); };
      } catch (e) {
        console.error(e);
        loader.innerHTML = `
          <div class="text-center">
            <p class="text-red-400 text-sm font-semibold">Generation Failed</p>
            <p class="text-xs text-gray-200">${e.message}</p>
            <p class="text-xs text-gray-300 mt-2">Click "New Sticker" to try again.</p>
          </div>
        `;
        btn.disabled = false;
      }
    }

    window.onload = generate;
  </script>
</body>
</html>
