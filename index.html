<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Weed Sticker Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ----  LOADER  ---- */
    .loader {
      border: 4px solid rgba(0,0,0,.15);
      border-left-color: #16a34a;
      border-radius: 50%;
      width: 56px; height: 56px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ----  LAYOUT  ---- */
    body { min-height: 100vh; display: flex; flex-direction: column; }
    main { flex: 1; }

    /* push hero DOWN */
    header { margin-top: clamp(4vh, 6vh, 12vh); }

    /* pull footer UP */
    footer { margin-bottom: clamp(2vh, 4vh, 8vh); }
  </style>
</head>

<body class="bg-white text-gray-800">
  <!-- HERO – lowered & bigger -->
  <header class="w-full px-4 pt-4 pb-2 text-center">
    <h1 class="font-extrabold text-green-600 drop-shadow-sm"
        style="font-size: clamp(2.8rem, 9vw, 5.5rem); line-height: 1.02;">
      Weed Sticker Generator
    </h1>
    <p class="text-gray-600 text-sm mt-2">Refresh for a new sticker</p>
  </header>

  <!-- MAIN – natural image size -->
  <main class="grid place-items-center px-4 pb-6">
    <div id="card" class="w-auto max-w-[95vw] max-h-[75vh] bg-gray-50 rounded-2xl shadow p-4 grid place-items-center">
      <div id="loader" class="flex flex-col items-center gap-3">
        <div class="loader"></div>
        <p class="font-medium text-sm text-gray-600">Generating image…</p>
        <p id="prompt" class="text-xs text-gray-400 italic px-4 text-center"></p>
      </div>
      <img id="sticker" class="hidden max-w-full max-h-full object-contain rounded-xl" alt="weed sticker">
    </div>
  </main>

  <!-- FOOTER – lifted & darker -->
  <footer class="text-center text-xs text-gray-700 py-4" style="margin-bottom: clamp(2vh, 4vh, 8vh);">
    Images are AI-generated · Developed by RAJ with ❤️
  </footer>

  <script>
    const prompts = [
      "A beautiful glass jar full of frosty cannabis buds, sticker art, die-cut",
      "A vibrant, cartoon-style cannabis leaf with a smiling face, sticker art",
      "A single frosty cannabis bud, sticker style, white background",
      "A minimalist line-art bong, clean sticker design",
      "A cute kawaii joint character with big eyes, sticker art",
      "Psychedelic colorful cannabis plant, die-cut sticker",
      "Vintage seed packet for 'Cosmic Kush', sticker illustration",
      "Happy stoned alien smoking a joint, cartoon sticker",
      "Cannabis-infused gummy bear sticker, vibrant colors",
      "'Good Vibes' text with cannabis leaf, retro 70s sticker",
      "Majestic lion with mane made of cannabis leaves, sticker art",
      "Skull with cannabis leaves growing out, detailed sticker"
    ];

    const used = new Set();
    function uniquePrompt() {
      let p;
      do { p = prompts[Math.floor(Math.random() * prompts.length)]; }
      while (used.has(p) && used.size < prompts.length);
      if (used.size === prompts.length) used.clear();
      used.add(p);
      return p;
    }

    async function generate() {
      const loader = document.getElementById('loader');
      const sticker = document.getElementById('sticker');
      const promptEl = document.getElementById('prompt');

      sticker.classList.add('hidden');
      loader.classList.remove('hidden');

      const prompt = uniquePrompt();
      promptEl.textContent = `"${prompt}"`;

      try {
        const res = await fetch('/api/generate-sticker', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt })
        });
        const data = await res.json();
        if (!data.success) throw new Error(data.error || 'Unknown');

        sticker.src = `data:image/png;base64,${data.image}`;
        sticker.onload = () => { loader.classList.add('hidden'); sticker.classList.remove('hidden'); };
        sticker.onerror = () => { throw new Error('Image load failed'); };
      } catch (e) {
        loader.innerHTML = `<p class="text-red-500 text-sm">Failed: ${e.message}<br><small class="text-xs">Refresh to retry</small></p>`;
      }
    }

    generate();
  </script>
</body>
</html>
